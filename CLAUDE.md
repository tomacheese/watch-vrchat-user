# Claude Code Guidelines

## 目的
このドキュメントは、Claude Code の作業方針とプロジェクト固有ルールを示すものです。

## 判断記録のルール
1. 判断内容の要約を記載する
2. 検討した代替案を列挙する
3. 採用しなかった案とその理由を明記する
4. 前提条件・仮定・不確実性を明示する
5. 他エージェントによるレビュー可否を示す

前提・仮定・不確実性を明示し、仮定を事実のように扱わないでください。

## プロジェクト概要
- 目的: VRChat ユーザーの Location 変更を監視し、Discord に通知する
- 主な機能: VRChat API ポーリング/WebSocket 監視、Discord Webhook 通知

## 重要ルール
- **会話言語**: 日本語
- **コミット規約**: Conventional Commits (`<type>(<scope>): <description>`, description は日本語)
- **コメント言語**: 日本語
- **エラーメッセージ**: 英語
- **記述ルール**: 日本語と英数字の間に半角スペースを挿入

## 環境のルール
- **ブランチ命名**: Conventional Branch (`feat/xxx`, `fix/xxx`)
- **GitHub 調査**: 必要に応じてテンポラリディレクトリに clone して調査
- **Renovate**: Renovate PR には直接コミットせず、別途対応する

## コード改修時のルール
- **エラーメッセージ**: 絵文字を使用する場合、メッセージ全体で統一する
- **TypeScript**: `skipLibCheck` は使用禁止
- **ドキュメント**: 関数・インターフェースに日本語の JSDoc を記載

## 相談ルール
- **Codex CLI**: 実装レビュー、局所設計、整合性確認に使用
- **Gemini CLI**: 外部仕様、最新情報確認に使用
- **指摘対応**: 指摘は黙殺せず、必ず対応または議論を行う

## 開発コマンド
```bash
# 依存関係インストール
pnpm install

# 開発サーバー (ホットリロード)
pnpm dev

# 本番実行
pnpm start

# Lint 実行
pnpm lint

# 自動修正 (Format & Lint Fix)
pnpm fix

# テスト実行
pnpm test
```

## アーキテクチャと主要ファイル
- `src/main.ts`: エントリーポイント
- `src/vrchat-client.ts`: VRChat API クライアント (SDK ラッパー)
- `src/discord-notifier.ts`: Discord 通知処理
- `src/location-store.ts`: ユーザー位置情報の管理
- `src/config.ts`: 設定読み込み
- `data/`: 永続化データ保存先 (Cookie 等)

## 実装パターン
- **VRChat API**: `vrchat` パッケージを使用 (パッチ適用済み)
- **永続化**: `keyv-file` を使用してローカルファイルに保存

## テスト
- **フレームワーク**: Jest
- **方針**: ロジック部分は可能な限りテストを作成する
- **コマンド**: `pnpm test`

## ドキュメント更新ルール
- **タイミング**: 機能追加・変更時、コンテキスト変更時
- **対象**: `README.md`, `GEMINI.md` 等

## 作業チェックリスト

### 新規改修時
1. プロジェクトを理解する
2. 作業ブランチが適切であることを確認する
3. 最新のリモートブランチに基づいた新規ブランチであることを確認する
4. PR がクローズされた不要ブランチが削除済みであることを確認する
5. 指定されたパッケージマネージャー (`pnpm`) で依存関係をインストールする

### コミット・プッシュ前
1. Conventional Commits に従っていることを確認する
2. センシティブな情報が含まれていないことを確認する
3. Lint / Format エラーがないことを確認する
4. 動作確認を行う

### PR 作成前
1. PR 作成の依頼があることを確認する
2. センシティブな情報が含まれていないことを確認する
3. コンフリクトの恐れがないことを確認する

### PR 作成後
1. コンフリクトがないことを確認する
2. PR 本文が最新状態のみを網羅していることを確認する
3. `gh pr checks <PR ID> --watch` で CI を確認する
4. Copilot レビューに対応し、コメントに返信する
5. Codex のコードレビューを実施し、指摘対応を行う
6. PR 本文の崩れがないことを確認する

## リポジトリ固有
- `patches/vrchat@2.20.7.patch` によるパッチが適用されているため、`vrchat` パッケージの更新時はパッチの整合性を確認する。